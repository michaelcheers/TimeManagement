Bridge.assembly("TimeManagement",function($asm,globals){"use strict";Bridge.define("TimeManagement.AddTaskUI",{statics:{methods:{Init:function(){var $t,Edit=null,AddTask=null,taskName=document.createElement("input"),playPauseButton=new TimeManagement.Timer,moneyAmount=($t=document.createElement("input"),$t.type="number",$t.style.width="5em",$t.style.textAlign="right",$t.placeholder="130",$t),currency=TimeManagement.Extensions.AddEnum(TimeManagement.Currency,document.createElement("select"),TimeManagement.Currency.CAD),status=TimeManagement.Extensions.AddElement(HTMLSelectElement,TimeManagement.Extensions.AddElement(HTMLSelectElement,document.createElement("select"),[TimeManagement.Extensions.Add(HTMLOptionElement,($t=document.createElement("option"),$t.value="False",$t),["In Progress"])]),[TimeManagement.Extensions.Add(HTMLOptionElement,($t=document.createElement("option"),$t.value="True",$t),["Complete"])]),labelList=new TimeManagement.LabelList(!0,void 0),editing=null,heading=document.createElement("h1"),submitButton;return AddTask=function(){var $t1,d,newTask;if(!playPauseButton.IsPaused){(e=>e.setCustomValidity("The timer is not paused."),e.reportValidity(),e)(playPauseButton.btn);return}if(!Bridge.referenceEquals(labelList.LabelInput.value,"")){(e=>e.setCustomValidity("There is an unadded label"),e.reportValidity(),e)(labelList.SubmitButton);return}d={};newTask=($t1=new(TimeManagement.Assigner$1(TimeManagement.Task))(editing||new TimeManagement.Task),$t1.Value.TaskName=taskName.value,$t1.Value.TimeSoFar=playPauseButton.TimeElapsed,$t1.Value.MoneyAmount=System.Decimal.tryParse(System.Double.format(moneyAmount.valueAsNumber),null,d)?Bridge.cast(d.v,System.Decimal,!0):System.Decimal.lift(null),$t1.Value.MoneyCurrency=System.Nullable.getValue(TimeManagement.Extensions.Value(TimeManagement.Currency,currency)),$t1.Value.IsComplete=System.Boolean.parse(status.value),$t1.Value.Labels=labelList.Labels,$t1.Value.TimeModified=Date.now(),$t1).Value;newTask.TimeSoFar.getTicks().gt(System.Int64(0))&&(newTask.TimeStarted=newTask.TimeModified);editing==null&&(newTask.TimeCreated=newTask.TimeModified,TimeManagement.App.Tasks.add(newTask));TimeManagement.App.TasksEdited();TimeManagement.MenuElementExtensions.Hide(TimeManagement.App.addTask)},submitButton=($t=document.createElement("button"),$t.onclick=function(e){AddTask()},$t),TimeManagement.App.addTask=TimeManagement.Extensions.AddUl(TimeManagement.HideableElement,TimeManagement.Extensions.Add(TimeManagement.HideableElement,TimeManagement.Extensions.Add(TimeManagement.HideableElement,TimeManagement.HideableElement.Create(),[TimeManagement.Extensions.Add(HTMLAnchorElement,($t=document.createElement("a"),$t.href="javascript:void(0)",$t.onclick=$asm.$.TimeManagement.AddTaskUI.f1,$t),["Close"])]),[heading]),[System.Array.init(["Task: ",taskName],System.Object),playPauseButton.Element,System.Array.init(["Money: ",moneyAmount," ",currency],System.Object),System.Array.init(["Status: ",status],System.Object),System.Array.init(["Labels: ",labelList.Element],System.Object),submitButton]),Edit=function(t){var $t1,amount;heading.innerHTML="";TimeManagement.Extensions.Add(HTMLHeadingElement,heading,[Bridge.hasValue(t)?"Edit a Task":"Add a Task"]);submitButton.innerHTML="";TimeManagement.Extensions.Add(HTMLButtonElement,submitButton,[Bridge.hasValue(t)?"Edit Task":"Add Task"]);t=(editing=t)||($t1=new TimeManagement.Task,$t1.TaskName="",$t1);taskName.value=t.TaskName;playPauseButton.times=t.TimeSoFar.getTicks().equals(System.Int64(0))?System.Array.init(0,0,System.Double):System.Array.init([Date.now()-t.TimeSoFar.getTotalMilliseconds(),Date.now()],System.Double);playPauseButton.Update();System.Nullable.liftne("ne",amount=Bridge.is(t.MoneyAmount,System.Decimal)?System.Nullable.getValue(t.MoneyAmount):null,System.Decimal.lift(null))?moneyAmount.valueAsNumber=System.Decimal.toFloat(amount):moneyAmount.value="";TimeManagement.Extensions.SetValue(TimeManagement.Currency,currency,t.MoneyCurrency);status.value=System.Boolean.toString(t.IsComplete);labelList.Labels=t.Labels;labelList.Rerender();TimeManagement.MenuElementExtensions.Show(TimeManagement.App.addTask)},$t=new TimeManagement.AddTaskUI,$t.Edit=Edit,$t}}},fields:{Edit:null},ctors:{ctor:function(){this.$initialize()}},methods:{New:function(){this.Edit(null)}}});Bridge.ns("TimeManagement.AddTaskUI",$asm.$);Bridge.apply($asm.$.TimeManagement.AddTaskUI,{f1:function(_){TimeManagement.MenuElementExtensions.Hide(TimeManagement.App.addTask)}});Bridge.define("TimeManagement.App",{main:function(){var $t,$t1,$t2,Menu=null,serialized;document.head.appendChild(TimeManagement.Extensions.Add(HTMLStyleElement,document.createElement("style"),["th, td { text-align:center; border: 1px solid black }"]));TimeManagement.App.labelList=((e,c)=>c.appendChild(e))(($t=document.createElement("datalist"),$t.id=TimeManagement.App.labelListID,$t),document.body);(serialized=Bridge.as(Bridge.global.localStorage.getItem("tasks"),System.String))!=null&&(TimeManagement.App.Tasks=Newtonsoft.Json.JsonConvert.DeserializeObject(serialized,System.Collections.Generic.List$1(TimeManagement.Task)));TimeManagement.App.UpdateLabels();TimeManagement.App.root=document.body.appendChild(document.createElement("div"));Menu=$asm.$.TimeManagement.App.f2;TimeManagement.App.menu=TimeManagement.Extensions.AddToBody(HTMLDivElement,Menu());TimeManagement.App.addTaskUI=TimeManagement.AddTaskUI.Init();TimeManagement.Extensions.AddToBody(HTMLFieldSetElement,TimeManagement.Extensions.AddUl(HTMLFieldSetElement,TimeManagement.Extensions.Add(HTMLFieldSetElement,document.createElement("fieldset"),[TimeManagement.Extensions.Add(HTMLLegendElement,document.createElement("legend"),["Filters"])]),[System.Array.init(["Labels:",($t=($t1=new TimeManagement.LabelList(!1,void 0),$t1.OnLabelListChange=TimeManagement.App.UpdateTaskList,$t1),TimeManagement.App.filterLabelList=$t,$t).Element],System.Object),System.Array.init(["Task Status: ",($t1=TimeManagement.Extensions.AddEnum(TimeManagement.TaskState,document.createElement("select"),void 0,"Any"),TimeManagement.App.filterTaskStatus=$t1,$t1)],System.Object)]));TimeManagement.Extensions.AddToBody(HTMLBRElement,document.createElement("br"));TimeManagement.App.taskListSlot=TimeManagement.Extensions.AddToBody(HTMLDivElement,document.createElement("div"));TimeManagement.App.editButtons=!0;TimeManagement.App.UpdateTaskList();TimeManagement.Extensions.AddToBody(HTMLBRElement,document.createElement("br"));TimeManagement.Extensions.AddToBody(HTMLAnchorElement,TimeManagement.Extensions.Add(HTMLAnchorElement,($t2=document.createElement("a"),$t2.href="javascript:void(0)",$t2.onclick=$asm.$.TimeManagement.App.f4,$t2),["CSV Export"]))},statics:{fields:{labelListID:null,root:null,MenuElements:null,Tasks:null,Labels:null,labelList:null,filterLabelList:null,filterTaskStatus:null,editButtons:!1,menu:null,addTask:null,taskListSlot:null,addTaskUI:null,InCAD:null},ctors:{init:function(){this.labelListID="labelList";this.MenuElements=new(System.Collections.Generic.List$1(TimeManagement.HideableElement).ctor);this.Tasks=new(System.Collections.Generic.List$1(TimeManagement.Task).ctor);this.Labels=new(System.Collections.Generic.List$1(System.String).ctor);this.InCAD=$asm.$.TimeManagement.App.f5(new(System.Collections.Generic.Dictionary$2(TimeManagement.Currency,System.Decimal).ctor))}},methods:{TryParseTimeSpan:function(time,outValue){var $t,split,splitParsed,s,p;outValue.v=System.TimeSpan.zero;split=System.String.split(time,[58].map(function(i){return String.fromCharCode(i)}));split.reverse();splitParsed=new(System.Collections.Generic.List$1(System.Int32).ctor);$t=Bridge.getEnumerator(split);try{while($t.moveNext()){if(s=$t.Current,p={},!System.Int32.tryParse(s,p))return!1;splitParsed.add(p.v)}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}return outValue.v=System.TimeSpan.fromSeconds(System.Linq.Enumerable.from(splitParsed,System.Int32).zip(System.Array.init([1,60,3600],System.Int32),$asm.$.TimeManagement.App.f6).sum()),!0},TasksEdited:function(){Bridge.global.localStorage.setItem("tasks",Newtonsoft.Json.JsonConvert.SerializeObject(TimeManagement.App.Tasks));TimeManagement.App.UpdateLabels();TimeManagement.App.filterLabelList.LabelListChange()},UpdateLabels:function(){var $t,$t1,label;TimeManagement.App.Labels=System.Linq.Enumerable.from(TimeManagement.App.Tasks,TimeManagement.Task).selectMany($asm.$.TimeManagement.App.f7).distinct().toList(System.String);TimeManagement.App.labelList.innerHTML="";$t=Bridge.getEnumerator(System.Linq.Enumerable.from(TimeManagement.App.Labels,System.String).orderBy($asm.$.TimeManagement.App.f8));try{while($t.moveNext())label=$t.Current,TimeManagement.Extensions.Add(HTMLDataListElement,TimeManagement.App.labelList,[($t1=document.createElement("option"),$t1.value=label,$t1)])}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},TaskList:function(){var $t,$t1,div=document.createElement("div"),table=((e,c)=>c.appendChild(e))(TimeManagement.Extensions.Add(HTMLTableElement,document.createElement("table"),[TimeManagement.Extensions.Add(HTMLTableRowElement,TimeManagement.Extensions.Add(HTMLTableRowElement,TimeManagement.Extensions.Add(HTMLTableRowElement,TimeManagement.Extensions.Add(HTMLTableRowElement,TimeManagement.Extensions.Add(HTMLTableRowElement,TimeManagement.Extensions.Add(HTMLTableRowElement,TimeManagement.Extensions.Add(HTMLTableRowElement,document.createElement("tr"),[TimeManagement.Extensions.Add(HTMLTableCellElement,document.createElement("th"),["Task Name"])]),[TimeManagement.Extensions.Add(HTMLTableCellElement,document.createElement("th"),["Time So Far"])]),[TimeManagement.Extensions.Add(HTMLTableCellElement,document.createElement("th"),["Money (CAD)"])]),[TimeManagement.Extensions.Add(HTMLTableCellElement,document.createElement("th"),["Task Status"])]),[TimeManagement.Extensions.Add(HTMLTableCellElement,document.createElement("th"),["Labels"])]),[TimeManagement.App.editButtons?TimeManagement.Extensions.Add(HTMLTableCellElement,document.createElement("th"),["Edit"]):null]),[TimeManagement.Extensions.Add(HTMLTableCellElement,document.createElement("th"),["$/hour"])])]),div),tasks=TimeManagement.App.Tasks,taskState,task,amount,amount_,money;TimeManagement.App.filterLabelList.Labels.Count>0&&(tasks=System.Linq.Enumerable.from(tasks,TimeManagement.Task).where($asm.$.TimeManagement.App.f9));taskState=new TimeManagement.TaskState;(taskState=Bridge.is(TimeManagement.Extensions.Value(TimeManagement.TaskState,TimeManagement.App.filterTaskStatus),System.Int32)?System.Nullable.getValue(TimeManagement.Extensions.Value(TimeManagement.TaskState,TimeManagement.App.filterTaskStatus)):null)!=null&&(tasks=System.Linq.Enumerable.from(tasks,TimeManagement.Task).where(function(t){return t.State===taskState}));$t=Bridge.getEnumerator(tasks,TimeManagement.Task);try{while($t.moveNext())task={v:$t.Current},TimeManagement.Extensions.Add(HTMLTableElement,table,[TimeManagement.Extensions.Add(HTMLTableRowElement,TimeManagement.Extensions.Add(HTMLTableRowElement,TimeManagement.Extensions.Add(HTMLTableRowElement,TimeManagement.Extensions.Add(HTMLTableRowElement,TimeManagement.Extensions.Add(HTMLTableRowElement,TimeManagement.Extensions.Add(HTMLTableRowElement,TimeManagement.Extensions.Add(HTMLTableRowElement,document.createElement("tr"),[TimeManagement.Extensions.Add(HTMLTableCellElement,document.createElement("td"),[task.v.TaskName])]),[TimeManagement.Extensions.Add(HTMLTableCellElement,document.createElement("td"),[TimeManagement.Extensions.ToTimeString(task.v.TimeSoFar)])]),[TimeManagement.Extensions.Add(HTMLTableCellElement,($t1=document.createElement("td"),$t1.title=System.Nullable.liftne("ne",amount=Bridge.is(task.v.MoneyAmount,System.Decimal)?System.Nullable.getValue(task.v.MoneyAmount):null,System.Decimal.lift(null))?System.String.format("{0} {1}",amount,Bridge.box(task.v.MoneyCurrency,TimeManagement.Currency,System.Enum.toStringFn(TimeManagement.Currency))):"",$t1),[System.Nullable.liftne("ne",amount_=Bridge.is(task.v.MoneyAmount,System.Decimal)?System.Nullable.getValue(task.v.MoneyAmount):null,System.Decimal.lift(null))?Bridge.Int.format(amount_.mul(TimeManagement.App.InCAD.getItem(task.v.MoneyCurrency)),"0"):""])]),[TimeManagement.Extensions.Add(HTMLTableCellElement,document.createElement("td"),[TimeManagement.Extensions.ToCamelString(TimeManagement.TaskState,task.v.State)])]),[TimeManagement.Extensions.Add(HTMLTableCellElement,($t1=document.createElement("td"),$t1.style.textAlign="left",$t1),TimeManagement.Extensions.JoinBR(task.v.Labels))]),[TimeManagement.App.editButtons?TimeManagement.Extensions.Add(HTMLTableCellElement,document.createElement("td"),[TimeManagement.Extensions.Add(HTMLAnchorElement,($t1=document.createElement("a"),$t1.href="javascript:void(0)",$t1.onclick=function($me,task){return function(_){TimeManagement.App.addTaskUI.Edit(task.v)}}(this,task),$t1),["Edit"])]):null]),[TimeManagement.Extensions.Add(HTMLTableCellElement,document.createElement("td"),[System.Nullable.liftne("ne",money=Bridge.is(task.v.MoneyAmount,System.Decimal)?System.Nullable.getValue(task.v.MoneyAmount):null,System.Decimal.lift(null))&&task.v.TimeSoFar.getTicks().gt(System.Int64(0))&&task.v.IsComplete?System.Double.format(System.Decimal.toFloat(money.mul(TimeManagement.App.InCAD.getItem(task.v.MoneyCurrency)))/task.v.TimeSoFar.getTotalHours(),"0"):""])])])}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}return div},UpdateTaskList:function(){TimeManagement.App.taskListSlot.innerHTML="";TimeManagement.Extensions.Add(HTMLDivElement,TimeManagement.App.taskListSlot,[TimeManagement.App.TaskList()])},ExportToCSV:function(fileName,rows){for(var blob,link,url,processRow=function(row){for(var innerValue,result,finalVal="",j=0;j<row.length;j++)innerValue=row[j]===null?"":row[j].toString(),row[j]instanceof Date&&(innerValue=row[j].toLocaleString()),result=innerValue.replace(/"/g,'""'),result.search(/("|,|\n)/g)>=0&&(result='"'+result+'"'),j>0&&(finalVal+=","),finalVal+=result;return finalVal+"\n"},csvFile="",i=0;i<rows.length;i++)csvFile+=processRow(rows[i]);blob=new Blob([csvFile],{type:"text/csv;charset=utf-8;"});navigator.msSaveBlob?navigator.msSaveBlob(blob,fileName):(link=document.createElement("a"),link.download!==undefined&&(url=URL.createObjectURL(blob),link.setAttribute("href",url),link.setAttribute("download",fileName),link.style.visibility="hidden",document.body.appendChild(link),link.click(),document.body.removeChild(link)))}}}});Bridge.ns("TimeManagement.App",$asm.$);Bridge.apply($asm.$.TimeManagement.App,{f1:function(_){TimeManagement.App.addTaskUI.New();TimeManagement.MenuElementExtensions.Show(TimeManagement.App.addTask)},f2:function(){var $t1;return TimeManagement.Extensions.AddUl(HTMLDivElement,document.createElement("div"),[TimeManagement.Extensions.Add(HTMLAnchorElement,($t1=document.createElement("a"),$t1.href="javascript:void(0)",$t1.onclick=$asm.$.TimeManagement.App.f1,$t1),["+ New Task"])])},f3:function(t,i){return System.Array.init([t.TaskName,System.Double.format(t.TimeSoFar.getTotalHours()),System.Nullable.lift2("mul",t.MoneyAmount,TimeManagement.App.InCAD.getItem(t.MoneyCurrency)).toString(),TimeManagement.Extensions.ToCamelString(TimeManagement.TaskState,t.State),Bridge.toArray(t.Labels).join("\n"),System.String.format("=$C{0}/$B{1}",Bridge.box(i+2|0,System.Int32),Bridge.box(i+2|0,System.Int32))],System.String)},f4:function(_){var $t3;TimeManagement.App.ExportToCSV(System.String.format("Time Information ({0:MMMM d, yyyy}).csv",[Bridge.box(System.DateTime.getNow(),System.DateTime,System.DateTime.format)]),($t3=System.Array.type(System.String),System.Linq.Enumerable.from(TimeManagement.Enumerable.Prepend(System.Array.type(System.String),System.Linq.Enumerable.from(TimeManagement.App.Tasks,TimeManagement.Task).select($asm.$.TimeManagement.App.f3),System.Array.init(["Task Name","Hours Spent","Money (CAD)","Task Status","Labels","$/hour"],System.String)),$t3).ToArray($t3)))},f5:function(_o1){return _o1.setItem(TimeManagement.Currency.CAD,System.Decimal(1)),_o1.setItem(TimeManagement.Currency.USD,System.Decimal(1.22955,5)),_o1.setItem(TimeManagement.Currency.EUR,System.Decimal(1.3987,5)),_o1},f6:function(p1,mul){return Bridge.Int.mul(p1,mul)},f7:function(t){return t.Labels},f8:function(l){return l},f9:function(t){return System.Linq.Enumerable.from(t.Labels,System.String).any(Bridge.fn.cacheBind(TimeManagement.App.filterLabelList.Labels,TimeManagement.App.filterLabelList.Labels.contains))}});Bridge.define("TimeManagement.Assigner$1",function(T){return{props:{Value:Bridge.getDefaultValue(T)},ctors:{ctor:function(v){this.$initialize();this.Value=v}}}});Bridge.define("TimeManagement.Currency",{$kind:"enum",statics:{fields:{CAD:0,USD:1,EUR:2}}});Bridge.define("TimeManagement.Enumerable",{statics:{methods:{Prepend:function(T,arr,value){return System.Linq.Enumerable.from(System.Array.init([value],T),T).concat(arr)},Append:function(T,arr,value){return System.Linq.Enumerable.from(arr,T).concat(System.Array.init([value],T)).ToArray(T)},Zip:function(T,T2,e_a,e_b){return System.Linq.Enumerable.from(e_a,T).zip(e_b,function(a,b){return new(System.ValueTuple$2(T,T2).$ctor1)(a,b)})}}}});Bridge.define("TimeManagement.Extensions",{statics:{methods:{AddToBody:function(T,n){return TimeManagement.App.root.appendChild(n)},Add:function(T,element,nodes){var $t,node;nodes===void 0&&(nodes=[]);$t=Bridge.getEnumerator(nodes);try{while($t.moveNext())if(node=$t.Current,node==null)continue;else Bridge.is(node,System.String)?element.appendChild(document.createTextNode(node)):element.appendChild(node)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}return element},AddElement:function(T,element,nodes){return nodes===void 0&&(nodes=[]),TimeManagement.Extensions.Add(T,element,nodes)},AddDiv:function(T,element,nodes){return nodes===void 0&&(nodes=[]),TimeManagement.Extensions.Add(T,element,[TimeManagement.Extensions.Add(HTMLDivElement,document.createElement("div"),nodes)])},AddUl:function(T,element,nodes){return nodes===void 0&&(nodes=[]),TimeManagement.Extensions.Add(T,element,[TimeManagement.Extensions.Add(HTMLUListElement,document.createElement("ul"),nodes.map($asm.$.TimeManagement.Extensions.f1))])},AddCamelSpace:function(str){return System.Text.RegularExpressions.Regex.replace(System.Text.RegularExpressions.Regex.replace(str,"([^_a-z])([^_a-z][a-z])","$1 $2"),"([a-z])([^_a-z])","$1 $2")},ToCamelString:function(T,e){return System.String.replaceAll(TimeManagement.Extensions.AddCamelSpace(System.Enum.toString(Bridge.getType(e,T),e)),String.fromCharCode(95),String.fromCharCode(32))},AddEnum:function(T,select,defaultValue,defaultValueString){var $t,$t1,value;defaultValue===void 0&&(defaultValue=null);defaultValueString===void 0&&(defaultValueString="");defaultValue==null&&select.add(TimeManagement.Extensions.Add(HTMLOptionElement,($t=document.createElement("option"),$t.value="",$t.selected=!0,$t.disable=!0,$t),[defaultValueString]));$t=Bridge.getEnumerator(System.Enum.getValues(T));try{while($t.moveNext())value=Bridge.cast($t.Current,T),select.add(TimeManagement.Extensions.Add(HTMLOptionElement,($t1=document.createElement("option"),$t1.value=Bridge.toString(System.Nullable.getValue(Bridge.cast(Bridge.unbox(value,System.Int32),System.Int32))),$t1.selected=Bridge.equals(defaultValue,value),$t1),[TimeManagement.Extensions.ToCamelString(T,value)]))}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}return select},Value:function(T,select){return Bridge.referenceEquals(select.value,"")?null:Bridge.cast(System.Nullable.getValue(Bridge.cast(Bridge.unbox(Bridge.box(System.Int32.parse(select.value),System.Int32),T),T)),T,!0)},SetValue:function(T,select,value){return select.value=Bridge.toString(System.Nullable.getValue(Bridge.cast(Bridge.unbox(value,System.Int32),System.Int32))),select},ToTimeString:function(time){return time.toString(System.TimeSpan.gte(time,System.TimeSpan.fromHours(1))?"h\\:mm\\:ss":"m\\:ss")},JoinBR:function(strings){var $t,Inner=null;return Inner=function(){return new(Bridge.GeneratorEnumerable$1(System.Object))(Bridge.fn.bind(this,function(){var $step=0,$jumpFromFinally,$returnValue,enumer,$async_e,$async_e1,$enumerator=new(Bridge.GeneratorEnumerator$1(System.Object))(Bridge.fn.bind(this,function(){try{for(;;)switch($step){case 0:enumer=Bridge.getEnumerator(strings,System.String);$step=1;continue;case 1:if(!enumer.System$Collections$IEnumerator$moveNext()){$step=2;continue}$step=3;continue;case 2:return!1;case 3:return $enumerator.current=enumer[Bridge.geti(enumer,"System$Collections$Generic$IEnumerator$1$System$String$Current$1","System$Collections$Generic$IEnumerator$1$Current$1")],$step=4,!0;case 4:if(enumer.System$Collections$IEnumerator$moveNext()){$step=5;continue}$step=8;continue;case 5:return $enumerator.current=document.createElement("br"),$step=6,!0;case 6:return $enumerator.current=enumer[Bridge.geti(enumer,"System$Collections$Generic$IEnumerator$1$System$String$Current$1","System$Collections$Generic$IEnumerator$1$Current$1")],$step=7,!0;case 7:$step=4;continue;case 8:$step=9;continue;case 9:if(Bridge.hasValue(enumer)&&enumer.System$IDisposable$Dispose(),$jumpFromFinally>-1)$step=$jumpFromFinally,$jumpFromFinally=null;else if($async_e){throw $async_e;return}else if(Bridge.isDefined($returnValue)){$tcs.setResult($returnValue);return}$step=10;continue;case 10:default:return!1}}catch($async_e1){if($async_e=System.Exception.create($async_e1),$step>=1&&$step<=8){$step=9;$enumerator.moveNext();return}throw $async_e;}}),function(){if($step>=1&&$step<=8){$step=9;$enumerator.moveNext();return}});return $enumerator}))},$t=System.Object,System.Linq.Enumerable.from(Inner(),$t).ToArray($t)}}}});Bridge.ns("TimeManagement.Extensions",$asm.$);Bridge.apply($asm.$.TimeManagement.Extensions,{f1:function(n){return Bridge.is(n,System.Array.type(System.Object))?TimeManagement.Extensions.Add(HTMLLIElement,document.createElement("li"),n):Bridge.is(n,System.String)?TimeManagement.Extensions.Add(HTMLLIElement,document.createElement("li"),[n]):TimeManagement.Extensions.Add(HTMLLIElement,document.createElement("li"),[n])}});Bridge.define("TimeManagement.HideableElement",{inherits:[HTMLElement],statics:{methods:{Create:function(){var r=(e=>e.style.display="none",e)(TimeManagement.Extensions.AddToBody(HTMLDivElement,document.createElement("div")));return TimeManagement.App.MenuElements.add(r),r}}}});Bridge.define("TimeManagement.LabelList",{fields:{Element:null,Form:null,SubmitButton:null,LabelInput:null,LabelsUL:null,Labels:null,Flexible:!1,OnLabelListChange:null},ctors:{init:function(){this.Labels=new(System.Collections.Generic.List$1(System.String).ctor)},ctor:function(flexible,slot){slot===void 0&&(slot=null);this.$initialize();this.Flexible=flexible;this.Element=slot||document.createElement("div");this.Rerender();this.LabelListChange()}},methods:{Rerender:function(){var $t,labels,label;this.Element.innerHTML="";this.LabelsUL=((e,c)=>c.appendChild(e))(document.createElement("ul"),this.Element);this.Form=($t=document.createElement("form"),$t.onsubmit=Bridge.fn.bind(this,$asm.$.TimeManagement.LabelList.f1),$t);this.LabelInput=((e,c)=>c.appendChild(e))(this.Flexible?(e=>e.setAttribute("list",TimeManagement.App.labelListID),e)(($t=document.createElement("input"),$t.required=!0,$t)):($t=document.createElement("select"),$t.required=!0,$t.oninput=Bridge.fn.bind(this,$asm.$.TimeManagement.LabelList.f2),$t),this.Form);this.SubmitButton=((e,c)=>c.appendChild(e))(TimeManagement.Extensions.Add(HTMLButtonElement,document.createElement("button"),["+"]),this.Form);TimeManagement.Extensions.Add(HTMLUListElement,this.LabelsUL,[TimeManagement.Extensions.Add(HTMLLIElement,document.createElement("li"),[this.Form])]);labels=this.Labels;this.Labels=new(System.Collections.Generic.List$1(System.String).ctor);$t=Bridge.getEnumerator(labels);try{while($t.moveNext())label=$t.Current,this.LabelInput.value=label,this.SubmitButton.click()}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},LabelListChange:function(){var $t,$t1,fll,label;if(!this.Flexible){fll=this.LabelInput.value;try{this.LabelInput.innerHTML="";$t=Bridge.getEnumerator(System.Linq.Enumerable.from(TimeManagement.App.Labels,System.String).except(this.Labels).orderBy($asm.$.TimeManagement.LabelList.f3));try{while($t.moveNext())label=$t.Current,TimeManagement.Extensions.Add(HTMLInputElement,this.LabelInput,[TimeManagement.Extensions.Add(HTMLOptionElement,($t1=document.createElement("option"),$t1.value=label,$t1),[label])])}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}if(this.Labels.RemoveAll($asm.$.TimeManagement.LabelList.f4)===0)return;this.Rerender()}finally{this.LabelInput.value=fll;Bridge.staticEquals(this.OnLabelListChange,null)?null:this.OnLabelListChange()}}}}});Bridge.ns("TimeManagement.LabelList",$asm.$);Bridge.apply($asm.$.TimeManagement.LabelList,{f1:function(e){var $t1,adding;e.preventDefault();adding=this.LabelInput.value;this.Labels.add(adding);this.LabelsUL.insertBefore(TimeManagement.Extensions.Add(HTMLLIElement,($t1=document.createElement("li"),$t1.style.cursor="pointer",$t1.onclick=Bridge.fn.bind(this,function(_){this.LabelsUL.removeChild(_.target);this.Labels.remove(adding);this.LabelListChange()}),$t1),[adding]),this.LabelsUL.lastElementChild);this.LabelInput.value="";this.LabelInput.focus();this.LabelListChange()},f2:function(_){this.SubmitButton.click()},f3:function(l){return l},f4:function(label1){return!TimeManagement.App.Labels.contains(label1)}});Bridge.define("TimeManagement.MenuElementExtensions",{statics:{methods:{Show:function(me){return TimeManagement.App.MenuElements.ForEach($asm.$.TimeManagement.MenuElementExtensions.f1),(e=>e.style.display="none",e)(TimeManagement.App.menu),TimeManagement.App.editButtons=!1,TimeManagement.App.UpdateTaskList(),(e=>e.style.display="",e)(me)},Hide:function(me){return(e=>e.style.display="none",e)(Bridge.cast(me,HTMLElement)),(e=>e.style.display="",e)(TimeManagement.App.menu),TimeManagement.App.editButtons=!0,TimeManagement.App.UpdateTaskList(),me}}}});Bridge.ns("TimeManagement.MenuElementExtensions",$asm.$);Bridge.apply($asm.$.TimeManagement.MenuElementExtensions,{f1:function(m){(e=>e.style.display="none",e)(Bridge.cast(m,HTMLElement))}});Bridge.define("TimeManagement.Task",{fields:{TaskName:null,TimeSoFar:null,IsComplete:!1,MoneyAmount:null,MoneyCurrency:0,TimeCreated:0,TimeStarted:null,TimeModified:0,Labels:null},props:{State:{get:function(){return this.IsComplete?TimeManagement.TaskState.Complete:this.TimeSoFar.getTicks().equals(System.Int64(0))?TimeManagement.TaskState.Planned:TimeManagement.TaskState.Started}}},ctors:{init:function(){this.TimeSoFar=new System.TimeSpan;this.Labels=new(System.Collections.Generic.List$1(System.String).ctor)}}});Bridge.define("TimeManagement.TaskState",{$kind:"enum",statics:{fields:{Planned:0,Started:1,Complete:2}}});Bridge.define("TimeManagement.Timer",{fields:{times:null,Element:null,interval:null,btn:null,timeIndicator:null},props:{IsPaused:{get:function(){return this.times.length%2==0}},TimeElapsed:{get:function(){for(var arr=this.IsPaused?this.times:TimeManagement.Enumerable.Append(System.Double,this.times,Date.now()),finalTime=0,n=0;n<arr.length;n=n+2|0)finalTime+=arr[System.Array.index(n+1|0,arr)]-arr[System.Array.index(n,arr)];return System.TimeSpan.fromMilliseconds(finalTime)}},TimeElapsedString:{get:function(){return TimeManagement.Extensions.ToTimeString(this.TimeElapsed)}}},ctors:{init:function(){this.times=System.Array.init(0,0,System.Double)},ctor:function(slot){slot===void 0&&(slot=null);this.$initialize();this.Element=slot||document.createElement("div");this.Rerender()}},methods:{Rerender:function(){var $t;this.Element.innerHTML="";TimeManagement.Extensions.Add(HTMLDivElement,this.Element,[this.btn=($t=document.createElement("button"),$t.onclick=Bridge.fn.bind(this,$asm.$.TimeManagement.Timer.f1),$t)]);TimeManagement.Extensions.Add(HTMLDivElement,this.Element,[" (",this.timeIndicator=($t=document.createElement("input"),$t.style.width="4em",$t.onchange=Bridge.fn.bind(this,$asm.$.TimeManagement.Timer.f2),$t),")"]);this.Update()},Update:function(){this.btn.innerHTML="";TimeManagement.Extensions.Add(HTMLButtonElement,this.btn,[this.times.length===0?"Start":this.IsPaused?"Resume":"Pause"]);this.timeIndicator.innerHTML="";this.timeIndicator.value=this.TimeElapsedString}}});Bridge.ns("TimeManagement.Timer",$asm.$);Bridge.apply($asm.$.TimeManagement.Timer,{f1:function(_){this.times=TimeManagement.Enumerable.Append(System.Double,this.times,Date.now());this.Update();var i;(i=Bridge.is(this.interval,System.Int32)?System.Nullable.getValue(this.interval):null)!=null&&Bridge.global.clearInterval(i);this.IsPaused||(this.interval=Bridge.global.setInterval(Bridge.fn.cacheBind(this,this.Update),1e3));this.timeIndicator.disabled=!this.IsPaused},f2:function(e){var ts={};TimeManagement.App.TryParseTimeSpan(e.currentTarget.value,ts)&&(this.times=System.Array.init([Date.now()-ts.v.getTotalMilliseconds(),Date.now()],System.Double))}})});